# SmartAgent2 系统自动化测试方案

**作者**: Manus AI
**日期**: 2026-02-08

## 1. 引言

本文档旨在回应用户关于对 SmartAgent2 系统进行自动化测试的需求。在全面审阅了您提供的系统代码、架构文档、接口设计、数据结构以及测试用例后，我们确认通过 Web 项目的方式对系统核心功能进行自动化测试是完全可行的。本方案将详细阐述测试策略、具体实施步骤及预期交付成果。

## 2. 系统概述与可测试性分析

SmartAgent2 是一个基于 FastAPI 框架构建的 AI 智能代理记忆系统。其核心功能是通过一系列 RESTful API 暴露的，这为自动化测试提供了便利的入口。系统架构清晰，模块化程度高，主要组件包括记忆提取器、检索器、遗忘器、画像管理器和核心控制器等。

经过分析，系统的可测试性非常高，主要体现在以下几个方面：

- **清晰的 API 端点**: 系统通过 HTTP 接口提供服务，所有核心功能均可以通过 API 调用进行触发和验证。
- **本地化部署能力**: 系统支持 `local` 存储模式，使用 SQLite 作为底层数据库，无需依赖复杂的外部数据库集群，极大地简化了测试环境的搭建。
- **现有测试基础**: 项目本身已包含覆盖存储层、核心逻辑层和 API 层的单元测试与集成测试，为我们提供了良好的起点。
- **明确的测试用例**: 您提供的测试用例文件详细描述了用户输入、系统预期反馈、记忆提取结果和用户画像构建情况，为端到端测试提供了明确的验收标准。

## 3. 自动化测试策略

我们的核心策略是构建一个自动化的端到端（E2E）测试流程，该流程将模拟您在测试用例文档中描述的完整对话场景，并自动验证系统的各项功能是否符合预期。此流程将集成到一个简单的 Web 界面中，方便触发和查看结果。

### 3.1 测试目标

本次自动化测试旨在达成以下核心目标：

1.  **功能验证**: 确保 `chat` 核心对话流程的正确性。
2.  **记忆提取**: 验证系统能否根据对话内容准确提取情景记忆和语义记忆。
3.  **画像构建**: 验证系统能否自动构建和更新用户画像（包括基本信息、偏好、关系等）。
4.  **记忆检索**: 验证在后续对话中，系统能否有效利用已形成的记忆进行个性化回复。
5.  **回归测试**: 建立一套可重复运行的测试基准，用于未来系统迭代时的回归验证。

### 3.2 测试范围

测试将覆盖以下关键 API 端点：

| 类别 | 端点 | 测试目的 |
| :--- | :--- | :--- |
| **对话** | `POST /api/v1/chat` | 模拟用户输入，获取系统回复 |
| **记忆查询** | `GET /api/v1/memory/episodic` | 验证情景记忆的提取结果 |
| | `GET /api/v1/memory/semantic` | 验证语义记忆的提取结果 |
| **画像查询** | `GET /api/v1/profile/{user_id}` | 验证用户画像的构建情况 |
| **统计查询** | `GET /api/v1/memory/stats/{user_id}` | 获取记忆统计数据以供分析 |

## 4. 自动化测试实施方案

我们将通过创建一个独立的 Web 项目来实施自动化测试。该项目包含一个简单的后端测试执行器和一个用于交互的前端界面。

### 步骤 1：环境搭建与系统启动

首先，我们会编写一个自动化脚本，负责准备测试环境。该脚本将执行以下操作：

1.  **安装依赖**: `pip install` SmartAgent2 的所有依赖项。
2.  **配置环境**: 创建 `.env` 文件，并填入必须的 `OPENAI_API_KEY`。为确保测试环境的纯净，数据库路径将指向一个临时的测试数据库文件。
3.  **启动应用**: 在后台启动 SmartAgent2 的 FastAPI 应用，使其服务端口（默认为 8000）暴露给测试程序。

### 步骤 2：测试用例场景模拟

这是自动化测试的核心。我们将编写一个 Python 测试脚本，该脚本会严格按照您提供的测试用例文件（`SmartAgent2_测试用例_-_用户输入与系统反馈.docx`）中的对话流程，通过 `requests` 库依次调用 `POST /api/v1/chat` 接口：

- **用户**: `demo_wangwu`
- **会话 ID**: 一个固定的测试会话 ID

**对话交互序列**：

1.  **输入**: `你好，我叫王五，今年35 岁，是一名产品经理，住在北京朝阳区。`
2.  **输入**: `我喜欢喝美式咖啡，不加糖。周末喜欢去三里屯逛街。`
3.  **输入**: `我女儿小红今年6 岁了，她特别喜欢画画。我老婆叫李梅，是个老师。`
4.  **输入**: `我每天早上9 点坐地铁去国贸上班，公司在CBD 那边。最近在做一个AI 产品。`
5.  **输入**: `你还记得我家里有几口人吗？我女儿喜欢什么？`
6.  **输入**: `帮我推荐一个适合带6 岁小孩去的周末活动`

在每一轮对话后，脚本会记录系统的实际回复。

### 步骤 3：结果自动验证

在完成上述 6 轮对话后，测试脚本将进入验证阶段。它会调用其他 API 端点来获取系统当前的内部状态，并与测试用例中的预期结果进行比对。

1.  **记忆验证**:
    -   调用 `GET /api/v1/memory/episodic?user_id=demo_wangwu` 和 `GET /api/v1/memory/semantic?user_id=demo_wangwu`。
    -   断言返回的情景记忆和语义记忆的总数是否与预期（分别为 13 条和 31 条）大致相符。
    -   随机抽查几条关键记忆（如“小红喜欢画画”、“王五喜欢喝美式咖啡”）是否存在。

2.  **画像验证**:
    -   调用 `GET /api/v1/profile/demo_wangwu`。
    -   验证 `basic_info`（姓名、年龄、职业等）、`preferences`（饮品、休闲活动）和 `relationships`（女儿、妻子）是否已正确生成。

### 步骤 4：构建 Web 测试界面

为了方便您使用，我们将初始化一个简单的静态 Web 应用（基于 React 和 TypeScript），提供以下功能：

-   一个醒目的 **“开始测试”** 按钮。
-   点击按钮后，前端将请求后端测试执行器启动完整的测试流程。
-   测试完成后，前端界面将清晰地展示测试报告，包括：
    -   每一轮对话的“用户输入”与“系统实际输出”。
    -   最终的记忆和画像验证结果（预期 vs. 实际）。
    -   一个明确的“通过”或“失败”状态指示。

## 5. 交付成果

完成此任务后，我们将向您交付以下成果：

1.  **自动化测试方案报告**: 即本文档的最终版本。
2.  **Web 测试项目源代码**: 一个包含前端界面和后端测试脚本的完整 Web 项目压缩包。您可以直接部署和运行该项目，以重复执行自动化测试。

我们相信，此方案能够系统性地、自动化地验证 SmartAgent2 的核心功能，为您后续的开发和迭代提供坚实的质量保障。
